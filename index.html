<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>主页 · Jae Ahn</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#ffffff; --card:#ffffff; --muted:#555;
  --text:#111; --accent:#2962ff; --accent2:#7c4dff;
  --ring: rgba(41,98,255,.25);
}
*{box-sizing:border-box}
body{
  background:var(--bg); color:var(--text);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  margin:0;padding:0;
}
header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid #eee;}
.nav{display:flex;align-items:center;justify-content:space-between;height:64px;padding:0 20px;}
.logo{font-weight:800;font-size:20px;color:var(--accent);}
.logo span{color:var(--accent2);}
nav a{margin-left:18px;color:#333;text-decoration:none;}
nav a:hover{color:var(--accent);}
.lang-switch{margin-left:20px;padding:6px 8px;border-radius:6px;border:1px solid #ccc;}
.hero{padding:60px 0;border-bottom:1px solid #eee;}
.hero-inner{display:grid;grid-template-columns:1fr 1fr;gap:40px;align-items:center;padding:0 20px;}
.hero-copy h1{font-size:38px;margin-bottom:12px;}
.hero-copy p{color:#444;line-height:1.6;}
.btn{padding:10px 16px;border-radius:12px;border:1px solid #dcdde1;background:#fff;color:#111;cursor:pointer;transition:.2s;}
.btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.06)}
.btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#fff;}
.btn[disabled]{opacity:.55;cursor:not-allowed}
.section{padding:48px 0;}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;padding:0 20px;}
.card{background:var(--card);border:1px solid #e8e8ef;border-radius:16px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);}
.card-badge{display:inline-block;padding:4px 8px;background:rgba(41,98,255,.12);border-radius:999px;margin-bottom:8px;font-size:13px;color:#2b2f36;}
.actions{display:flex;gap:10px;margin-top:8px;}
.site-footer{padding:30px 0;text-align:center;border-top:1px solid #eee;color:#555;}
.timeline{margin:0;padding-left:18px;}
.grid-2{display:grid;grid-template-columns:2fr 1fr;gap:28px;align-items:start;padding:0 20px;}

/* 头像悬浮卡片（右上角） */
.sidebar-card{
  position:fixed;
  top:90px; right:20px;
  width:220px;
  text-align:center;padding:20px;border:1px solid #e8e8ef;border-radius:16px;
  background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.1);
}
.sidebar-card .avatar{width:120px;height:120px;border-radius:50%;object-fit:cover;border:3px solid #fff;box-shadow:0 8px 26px rgba(0,0,0,.12);margin-bottom:12px;}
.sidebar-name{font-weight:700;margin:4px 0 2px 0;}
.sidebar-sub{font-size:13px;color:#667085}
.stat-row{display:flex;justify-content:center;gap:14px;margin:10px 0 2px}
.stat-pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#f3f5ff;border:1px solid #e6e8ff;font-size:13px;color:#2b2f36}
.sidebar-actions{display:flex;gap:10px;justify-content:center;margin-top:10px}

/* 留言板 */
.board-wrap{max-width:860px;margin:0 auto;padding:0 20px;}
.comment-input{width:100%;min-height:96px;border-radius:12px;border:1px solid #dcdde1;padding:12px;font-family:inherit;resize:vertical;}
.comment-toolbar{display:flex;gap:10px;margin-top:10px;align-items:center}
.comment-list{margin-top:18px}
.comment-item{background:#fafbff;border:1px solid #e8e8ef;border-radius:12px;padding:12px;margin-top:12px}
.comment-meta{font-size:12px;color:#667085;margin-bottom:6px}
.reply-btn{font-size:13px;color:#2962ff;background:transparent;border:none;cursor:pointer;padding:4px 6px;border-radius:8px}
.reply-box{margin-top:8px;display:none}
.reply-box textarea{width:100%;min-height:72px;border-radius:10px;border:1px solid #dcdde1;padding:10px}
.children{margin-left:18px;border-left:2px dashed #e6e8ff;padding-left:12px;margin-top:8px}

html{scroll-behavior:smooth}
@media (max-width:960px){
  .sidebar-card{position:relative;top:0;right:0;width:auto;margin:12px;}
  .grid-2{grid-template-columns:1fr}
}
</style>
</head>

<body>
<header class="site-header">
  <div class="container nav">
    <a class="logo" href="#">JAE<span>·DEV</span></a>
    <nav>
      <a href="#about" data-key="nav_about">关于我</a>
      <a href="#projects" data-key="nav_projects">项目</a>
      <a href="#contact" data-key="nav_contact">联系</a>
      <select id="langSelect" class="lang-switch">
        <option value="zh">中文</option>
        <option value="ko">한국어</option>
        <option value="en">English</option>
      </select>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container hero-inner">
    <div class="hero-copy">
      <h1 data-key="hero_title">你好，我是 <span class="accent">Jae</span> —— 软件工程师 / 中韩翻译专家</h1>
      <p data-key="hero_desc">专注于 AI 工具、游戏、音视频与电商系统的独立开发者，同时从事中韩双语翻译与本地化工作。</p>
      <div class="hero-cta">
        <a class="btn primary" href="#projects" data-key="hero_view_projects">查看项目</a>
        <a class="btn" href="#about" data-key="hero_about_me">了解我</a>
      </div>
    </div>
  </div>
</section>

<!-- 悬浮头像模块（右上角） -->
<div class="sidebar-card">
  <img class="avatar" src="assets/img/avatar.png" alt="avatar">
  <div class="sidebar-name">Jae Ahn</div>
  <div class="sidebar-sub" data-key="sidebar_sub">独立开发者 · 中韩翻译专家</div>
  <div class="stat-row">
    <div class="stat-pill">👍 <span id="likeCount">0</span></div>
    <div class="stat-pill">💬 <span id="commentCount">0</span></div>
  </div>
  <div class="sidebar-actions">
    <button class="btn" id="likeBtn" onclick="addLike()" data-key="btn_like">点赞</button>
    <button class="btn" onclick="document.getElementById('board').scrollIntoView({behavior:'smooth'})" data-key="btn_comment">留言</button>
  </div>
</div>

<section id="about" class="section">
  <div class="container grid-2">
    <div>
      <h2 data-key="about_title">关于我</h2>
      <p data-key="about_desc">· 现居首尔，热爱将创意快速落地。<br>· 软件工程师与中韩翻译专家。<br>· 偏好 Python / Django / Flask / Unity / 多语言系统开发。<br>· 关注低成本、跨平台与高效开发。</p>

      <aside class="card" style="margin-top:16px">
        <h3 data-key="career_title">工作经历（摘要）</h3>
        <ul class="timeline">
          <li><b>2025 — 现在</b> 独立开发者 · 全栈/AI/中韩翻译</li>
          <li><b>2023 — 2024</b> 学生项目 · 语音/图像/游戏</li>
        </ul>
      </aside>
    </div>
  </div>
</section>

<section id="projects" class="section">
  <div class="container">
    <h2 style="padding:0 20px" data-key="projects_title">定制项目</h2>
    <div class="cards">
      <article class="card project">
        <div class="card-badge">POS</div>
        <h3>TreasurePOS 收银系统</h3>
        <p data-key="projects_desc">一款本地运行的轻量级 POS 收银管理系统，支持发票打印、库存管理与多语言界面。</p>
        <div class="actions">
          <a class="btn primary" href="https://github.com/AHN2001hanyang/TreasurePOS" target="_blank" rel="noopener noreferrer" data-key="projects_btn">进入 GitHub 查看项目</a>
        </div>
      </article>
    </div>
  </div>
</section>

<!-- 先放“联系我” -->
<section id="contact" class="section" style="text-align:center;">
  <h2 data-key="contact_title">联系我</h2>
  <p>邮箱: <a href="mailto:jaehyung9483@gmail.com">jaehyung9483@gmail.com</a></p>
  <button class="btn primary" onclick="window.location='mailto:jaehyung9483@gmail.com'" data-key="contact_btn">发送邮件</button>
</section>

<!-- 最底部显示评论（带楼中楼回复） -->
<section id="board" class="section">
  <div class="board-wrap">
    <h2 data-key="board_title">网站留言板</h2>
    <textarea id="commentInput" class="comment-input" placeholder="写下你的建议..."></textarea>
    <div class="comment-toolbar">
      <button class="btn primary" onclick="submitComment()" data-key="btn_submit_comment">提交留言</button>
      <span style="color:#667085;font-size:13px" data-key="comment_hint">💡 评论将保存到 MongoDB</span>
    </div>
    <div id="commentList" class="comment-list"></div>
  </div>
</section>

<footer class="site-footer">
  <div class="container">
    <p>© <span id="year"></span> Jae Ahn · HTML/CSS/JS 构建 · MongoDB Atlas 支持</p>
  </div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();
const API_BASE = "https://myproject-iota-bay.vercel.app/api";

/* ===================== 点赞（防连续） ===================== */
function updateLikeButtonState(){
  const liked = localStorage.getItem("liked_site") === "1";
  const btn = document.getElementById("likeBtn");
  if(btn){
    btn.disabled = liked;
    btn.textContent = liked ? getI18n("btn_liked") || "已赞" : getI18n("btn_like") || "点赞";
  }
}
async function loadLikes(){
  try{
    const res = await fetch(`${API_BASE}/like`);
    const data = await res.json();
    document.getElementById("likeCount").textContent = data.count ?? 0;
  }catch(e){ console.error("加载点赞失败", e); }
  updateLikeButtonState();
}
async function addLike(){
  // 本地拦截重复点赞
  if(localStorage.getItem("liked_site")==="1"){
    alert(getI18n("like_once") || "已点赞，不能重复点赞");
    return;
  }
  try{
    await fetch(`${API_BASE}/like`, { method: "POST" });
    localStorage.setItem("liked_site","1");
    loadLikes();
  }catch(e){ console.error("点赞失败", e); }
}

/* ===================== 评论（展示全部 + 楼中楼） ===================== */
let COMMENT_CACHE = []; // 保留原始列表

// 构建树（支持 parentId；后端若未返回 parentId，则全部为顶层）
function buildTree(list){
  const map = new Map();
  list.forEach(c=>map.set(c._id || c.id || Math.random().toString(36).slice(2), {...c, id:(c._id||c.id), children:[]}));
  const roots = [];
  map.forEach(node=>{
    const pid = node.parentId || null;
    if(pid && map.has(pid)){
      map.get(pid).children.push(node);
    }else{
      roots.push(node);
    }
  });
  return roots;
}

// 递归渲染
function renderNode(node, idxPath){
  const timeStr = new Date(node.t || node.date).toLocaleString();
  const safeText = String(node.text||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");
  const id = node.id || node._id || ("c_"+Math.random().toString(36).slice(2));
  const replyId = `reply_${id}`;
  const boxId = `box_${id}`;
  return `
    <div class="comment-item" data-id="${id}">
      <div class="comment-meta">#${idxPath} · ${timeStr}</div>
      <div>${safeText}</div>
      <div style="margin-top:6px">
        <button class="reply-btn" onclick="toggleReplyBox('${boxId}')">${getI18n("reply")||"回复"}</button>
      </div>
      <div class="reply-box" id="${boxId}">
        <textarea id="${replyId}" placeholder="${getI18n("reply_placeholder")||"写下你的回复..."}"></textarea>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn primary" onclick="submitReply('${id}','${replyId}','${boxId}')">${getI18n("reply_submit")||"提交回复"}</button>
          <button class="btn" onclick="toggleReplyBox('${boxId}')">${getI18n("cancel")||"取消"}</button>
        </div>
      </div>
      ${node.children && node.children.length ? `
        <div class="children">
          ${node.children.map((child, i)=>renderNode(child, `${idxPath}.${i+1}`)).join("")}
        </div>
      ` : ""}
    </div>
  `;
}

function toggleReplyBox(boxId){
  const el = document.getElementById(boxId);
  if(el) el.style.display = (el.style.display==="block" ? "none" : "block");
}

async function loadComments(){
  try{
    const res = await fetch(`${API_BASE}/comments`);
    const list = await res.json();
    COMMENT_CACHE = Array.isArray(list) ? list : [];
    // 评论总数（包含所有层级）
    document.getElementById("commentCount").textContent = COMMENT_CACHE.length;

    const tree = buildTree(COMMENT_CACHE);
    let idx = 0;
    const html = tree.map(node => renderNode(node, String(++idx))).join("");
    document.getElementById("commentList").innerHTML = html;
  }catch(e){ console.error("加载评论失败", e); }
}

// 顶层评论
async function submitComment(){
  const text = document.getElementById("commentInput").value.trim();
  if(!text) return alert(getI18n("comment_placeholder_alert"));
  try{
    await fetch(`${API_BASE}/comments`, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({ text }) // 顶层无 parentId
    });
    document.getElementById("commentInput").value="";
    loadComments();
  }catch(e){ alert(getI18n("comment_submit_failed")); }
}

// 回复（带 parentId）
async function submitReply(parentId, inputId, boxId){
  const ta = document.getElementById(inputId);
  const text = (ta?.value || "").trim();
  if(!text) return alert(getI18n("comment_placeholder_alert"));
  try{
    await fetch(`${API_BASE}/comments`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ text, parentId })
    });
    if(ta) ta.value="";
    toggleReplyBox(boxId);
    loadComments();
  }catch(e){ alert(getI18n("comment_submit_failed")); }
}

/* ===================== 多语言 ===================== */
const dict = {
  zh: {
    nav_about:"关于我", nav_projects:"项目", nav_contact:"联系",
    hero_title:"你好，我是 <span class='accent'>Jae</span> —— 软件工程师 / 中韩翻译专家",
    hero_desc:"专注于 AI 工具、游戏、音视频与电商系统的独立开发者，同时从事中韩双语翻译与本地化工作。",
    hero_view_projects:"查看项目", hero_about_me:"了解我",
    sidebar_sub:"独立开发者 · 中韩翻译专家", btn_like:"点赞", btn_comment:"留言", btn_liked:"已赞", like_once:"已点赞，不能重复点赞",
    about_title:"关于我",
    about_desc:"· 现居首尔，热爱将创意快速落地。<br>· 软件工程师与中韩翻译专家。<br>· 偏好 Python / Django / Flask / Unity / 多语言系统开发。<br>· 关注低成本、跨平台与高效开发。",
    career_title:"工作经历（摘要）", projects_title:"定制项目",
    projects_desc:"一款本地运行的轻量级 POS 收银管理系统，支持发票打印、库存管理与多语言界面。",
    projects_btn:"进入 GitHub 查看项目", board_title:"网站留言板",
    btn_submit_comment:"提交留言", comment_hint:"💡 评论将保存到 MongoDB",
    contact_title:"联系我", contact_btn:"发送邮件",
    comment_placeholder_alert:"请输入内容",
    comment_submit_failed:"提交失败，请检查服务器状态",
    reply:"回复", reply_submit:"提交回复", reply_placeholder:"写下你的回复...", cancel:"取消"
  },
  ko: {
    nav_about:"소개", nav_projects:"프로젝트", nav_contact:"연락",
    hero_title:"안녕하세요, <span class='accent'>Jae</span> 입니다 — 소프트웨어 엔지니어 / 중한 번역 전문가",
    hero_desc:"AI 도구, 게임, 오디오·비디오 및 전자상거래 시스템에 집중하는 독립 개발자이며, 중한 번역 및 로컬라이제이션 업무를 수행합니다.",
    hero_view_projects:"프로젝트 보기", hero_about_me:"소개 보기",
    sidebar_sub:"독립 개발자 · 중한 번역 전문가", btn_like:"좋아요", btn_comment:"댓글", btn_liked:"좋아요 완료", like_once:"이미 좋아요를 눌렀습니다",
    about_title:"소개",
    about_desc:"· 서울 거주, 아이디어를 빠르게 실현하는 것을 좋아합니다.<br>· 소프트웨어 엔지니어 및 중한 번역 전문가입니다.<br>· Python / Django / Flask / Unity / 다국어 시스템 개발 선호.<br>· 저비용, 크로스플랫폼, 효율적 개발에 집중합니다.",
    career_title:"경력 요약", projects_title:"맞춤형 프로젝트",
    projects_desc:"로컬에서 실행되는 경량 POS 시스템으로 영수증 인쇄, 재고 관리, 다국어 UI를 지원합니다.",
    projects_btn:"GitHub에서 보기", board_title:"방명록",
    btn_submit_comment:"댓글 제출", comment_hint:"💡 댓글은 MongoDB에 저장됩니다.",
    contact_title:"연락하기", contact_btn:"이메일 보내기",
    comment_placeholder_alert:"내용을 입력해 주세요.",
    comment_submit_failed:"제출 실패, 서버 상태를 확인해 주세요.",
    reply:"답글", reply_submit:"답글 제출", reply_placeholder:"답글을 입력하세요...", cancel:"취소"
  },
  en: {
    nav_about:"About", nav_projects:"Projects", nav_contact:"Contact",
    hero_title:"Hi, I'm <span class='accent'>Jae</span> — Software Engineer / KR-CN Translator",
    hero_desc:"An indie developer focused on AI tools, games, audio/video, and e-commerce systems; also a KR-CN localization specialist.",
    hero_view_projects:"View Projects", hero_about_me:"About Me",
    sidebar_sub:"Indie Developer · KR-CN Translator", btn_like:"Like", btn_comment:"Comment", btn_liked:"Liked", like_once:"You already liked this",
    about_title:"About Me",
    about_desc:"· Based in Seoul, passionate about rapid prototyping.<br>· Software Engineer & KR-CN Translator.<br>· Prefer Python / Django / Flask / Unity / multilingual systems.<br>· Focused on low-cost, efficient cross-platform development.",
    career_title:"Career Summary", projects_title:"Custom Projects",
    projects_desc:"A lightweight local POS system supporting receipt printing, inventory, and multilingual UI.",
    projects_btn:"View on GitHub", board_title:"Guestbook",
    btn_submit_comment:"Submit Comment", comment_hint:"💡 Comments are saved to MongoDB",
    contact_title:"Contact Me", contact_btn:"Send Email",
    comment_placeholder_alert:"Please enter content.",
    comment_submit_failed:"Submit failed. Please check server status.",
    reply:"Reply", reply_submit:"Send Reply", reply_placeholder:"Write your reply...", cancel:"Cancel"
  }
};

function applyLang(lang){
  localStorage.setItem("lang", lang);
  const sel = document.getElementById("langSelect");
  if (sel) sel.value = lang;

  const map = dict[lang] || dict.en;
  document.querySelectorAll("[data-key]").forEach(el=>{
    const key = el.getAttribute("data-key");
    if (map[key]) el.innerHTML = map[key];
  });

  const ta = document.getElementById("commentInput");
  if (ta){
    ta.placeholder = {
      zh:"写下你的建议...",
      ko:"의견을 남겨주세요...",
      en:"Write your suggestion..."
    }[lang] || "Write your suggestion...";
  }
  document.documentElement.setAttribute("lang", lang === "ko" ? "ko" : (lang === "en" ? "en" : "zh-CN"));
  updateLikeButtonState();
}

function detectInitialLang(){
  const saved = localStorage.getItem("lang");
  if (saved) return saved;
  const nav = (navigator.language || navigator.userLanguage || "en").toLowerCase();
  if (nav.startsWith("zh")) return "zh";
  if (nav.startsWith("ko")) return "ko";
  return "en";
}

document.getElementById("langSelect").addEventListener("change", e=>{
  applyLang(e.target.value);
});

// 获取 i18n 字符串（alert 用）
function getI18n(key){
  const lang = localStorage.getItem("lang") || detectInitialLang();
  return (dict[lang] && dict[lang][key]) || (dict.en && dict.en[key]) || "";
}

/* ===================== 初始化 ===================== */
(function init(){
  const lang = detectInitialLang();
  applyLang(lang);
  loadLikes();
  loadComments();
})();
</script>

</body>
</html>
